experiment_dir: FME_OUTPUT_DIR # NOTE: this gets replaced by env var of same
                               #       name created in requeable-train.sh
save_checkpoint: true
validate_using_ema: true
ema:
  decay: 0.999
max_epochs: 5
n_forward_steps: 2
train_aggregator:
  spherical_power_spectrum: false
validation_aggregator:
  log_power_spectrum: false
logging:
  log_to_screen: true
  log_to_wandb: true
  log_to_file: true
  project: ace-era5-25km
  entity: ai2cm
train_loader:
  batch_size: BATCH_SIZE_VALUE
  num_data_workers: 2
  prefetch_factor: 2
  dataset:
    data_path: /pscratch/sd/e/elynnwu/fme-dataset
    file_pattern: 2026-02-23-rechunk-ERA5-025deg-8layer-2010-2011.zarr
    engine: zarr
    subset:
      start_time: '2010-01-01'
      stop_time: '2010-12-31'
validation_loader:
  batch_size: BATCH_SIZE_VALUE
  num_data_workers: 2
  prefetch_factor: 2
  dataset:
    data_path: /pscratch/sd/e/elynnwu/fme-dataset
    file_pattern: 2026-02-23-rechunk-ERA5-025deg-8layer-2010-2011.zarr
    engine: zarr
    subset:
      start_time: '2011-01-01'
      stop_time: '2011-12-31'    
optimization:
  enable_automatic_mixed_precision: false
  lr: 0.0001
  use_gradient_accumulation: true
  optimizer_type: AdamW
  kwargs:
    fused: true
    weight_decay: 0.01
stepper:
  loss:
    type: MSE
    weights:
      air_temperature_0: 0.5
      air_temperature_1: 0.5
      eastward_wind_0: 0.5
      northward_wind_0: 0.5
      specific_total_water_0: 0.5
      specific_total_water_1: 0.25
      specific_total_water_2: 0.5
      PRATEsfc: 0.5
      h500: 10
      TMP850: 5
      Q2m: 0.5
      DLWRFsfc: 2
      ULWRFsfc: 5
      USWRFsfc: 2
      DSWRFsfc: 2
      USWRFtoa: 2
      tendency_of_total_water_path_due_to_advection: 0.5
  step:
    type: single_module
    config:
      builder:
        type: SphericalFourierNeuralOperatorNet
        config:
          embed_dim: EMBED_DIM_VALUE
          filter_type: linear
          hard_thresholding_fraction: 1.0
          use_mlp: true
          normalization_layer: instance_norm
          num_layers: 8
          operator_type: dhconv
          scale_factor: SCALE_FACTOR_VALUE
          separable: false
          spectral_layers: 3
          spectral_transform: sht
      normalization:
        network:
          global_means_path: FME_STATS_DIR/centering.nc
          global_stds_path: FME_STATS_DIR/scaling-full-field.nc
        residual:
          global_means_path: FME_STATS_DIR/centering.nc
          global_stds_path: FME_STATS_DIR/scaling-residual.nc
      ocean:
        surface_temperature_name: surface_temperature
        ocean_fraction_name: ocean_fraction
      corrector:
        conserve_dry_air: true
        moisture_budget_correction: advection_and_precipitation
        force_positive_names:
          - specific_total_water_0
          - specific_total_water_1
          - specific_total_water_2
          - specific_total_water_3
          - specific_total_water_4
          - specific_total_water_5
          - specific_total_water_6
          - specific_total_water_7
          - Q2m
          - PRATEsfc
          - ULWRFsfc
          - ULWRFtoa
          - DLWRFsfc
          - DSWRFsfc
          - USWRFsfc
          - USWRFtoa
      next_step_forcing_names:
        - DSWRFtoa
      in_names:
      - land_fraction
      - ocean_fraction
      - sea_ice_fraction
      - DSWRFtoa
      - HGTsfc
      - PRESsfc
      - surface_temperature
      - TMP2m
      - Q2m
      - UGRD10m
      - VGRD10m
      - air_temperature_0
      - air_temperature_1
      - air_temperature_2
      - air_temperature_3
      - air_temperature_4
      - air_temperature_5
      - air_temperature_6
      - air_temperature_7
      - specific_total_water_0
      - specific_total_water_1
      - specific_total_water_2
      - specific_total_water_3
      - specific_total_water_4
      - specific_total_water_5
      - specific_total_water_6
      - specific_total_water_7
      - eastward_wind_0
      - eastward_wind_1
      - eastward_wind_2
      - eastward_wind_3
      - eastward_wind_4
      - eastward_wind_5
      - eastward_wind_6
      - eastward_wind_7
      - northward_wind_0
      - northward_wind_1
      - northward_wind_2
      - northward_wind_3
      - northward_wind_4
      - northward_wind_5
      - northward_wind_6
      - northward_wind_7
      out_names:
      - PRESsfc
      - surface_temperature
      - TMP2m
      - Q2m
      - UGRD10m
      - VGRD10m
      - air_temperature_0
      - air_temperature_1
      - air_temperature_2
      - air_temperature_3
      - air_temperature_4
      - air_temperature_5
      - air_temperature_6
      - air_temperature_7
      - specific_total_water_0
      - specific_total_water_1
      - specific_total_water_2
      - specific_total_water_3
      - specific_total_water_4
      - specific_total_water_5
      - specific_total_water_6
      - specific_total_water_7
      - eastward_wind_0
      - eastward_wind_1
      - eastward_wind_2
      - eastward_wind_3
      - eastward_wind_4
      - eastward_wind_5
      - eastward_wind_6
      - eastward_wind_7
      - northward_wind_0
      - northward_wind_1
      - northward_wind_2
      - northward_wind_3
      - northward_wind_4
      - northward_wind_5
      - northward_wind_6
      - northward_wind_7
      - LHTFLsfc
      - SHTFLsfc
      - PRATEsfc
      - ULWRFsfc
      - ULWRFtoa
      - DLWRFsfc
      - DSWRFsfc
      - USWRFsfc
      - USWRFtoa
      - tendency_of_total_water_path_due_to_advection
      - TMP850
      - h500
