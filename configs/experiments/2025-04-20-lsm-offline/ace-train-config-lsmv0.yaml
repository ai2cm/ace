experiment_dir: /results
save_checkpoint: true
validate_using_ema: true
ema:
  decay: 0.999
max_epochs: 25 # this is about equivalent to the amount of trainign for ACE2-ERA5/ACE2-SHiELD
n_forward_steps: 2
inference:
  n_forward_steps: 7300 #29200
  forward_steps_in_memory: 40
  loader:
    start_indices:
      times:
        - '0151-01-01T06:00:00'
        - '0171-01-01T06:00:00'
        - '0191-01-01T06:00:00'
        - '0211-01-01T06:00:00'
        - '0231-01-01T06:00:00'
        - '0251-01-01T06:00:00'
        - '0271-01-01T06:00:00'
        - '0291-01-01T06:00:00'
    dataset:
      data_path: /climate-default
      file_pattern: 2025-03-21-CM4-piControl-atmosphere-land-1deg-8layer-200yr.zarr
      engine: zarr
    num_data_workers: 32
  aggregator:
    log_histograms: true
    time_mean_reference_data: /statsdata/time-mean.nc
logging:
  log_to_screen: true
  log_to_wandb: true
  log_to_file: true
  project: ace2-cm4
  entity: ai2cm
train_loader:
  batch_size: 8
  num_data_workers: 8
  dataset:
    - data_path: /climate-default
      file_pattern: 2025-03-21-CM4-piControl-atmosphere-land-1deg-8layer-200yr.zarr
      engine: zarr
      subset:
        start_time: '0206-01-01T06:00:00'
        stop_time: '0306-01-01T06:00:00'
validation_loader:
  batch_size: 64
  num_data_workers: 8
  dataset:
    - data_path: /climate-default
      file_pattern: 2025-03-21-CM4-piControl-atmosphere-land-1deg-8layer-200yr.zarr
      engine: zarr
      subset:
        start_time: '0306-01-01T06:00:00'
        stop_time: '0308-01-01T06:00:00'
optimization:
  enable_automatic_mixed_precision: false
  lr: 0.00001
  optimizer_type: FusedAdam
  use_gradient_accumulation: true
stepper:
  loss:
    type: MSE
    weights:
      surface_temperature: 5
  input_masking:
    mask_value: 0
    fill_value: 0.0
    exclude_names_and_prefixes:
      - x
      - y
      - z
      - land_fraction
      - ocean_fraction
      - sea_ice_fraction
      - glac_fraction
      - soil_fraction
      - lake_fraction
      - LHTFLsfc
      - SHTFLsfc
      - PRATEsfc
      - total_frozen_precipitation_rate
      - ULWRFsfc
      - DLWRFsfc
      - DSWRFsfc
      - USWRFsfc
  step:
    type: single_module
    config:
      builder:
        type: LandNet
        config:
          hidden_dims: [256, 256, 256, 256]
          kernel_size: 1
          network_type: "MLP"
          use_positional_embedding: true
      normalization:
        network:
          global_means_path: /statsdata/centering.nc
          global_stds_path: /statsdata/scaling-full-field.nc
          fill_nans_on_normalize: true
      ocean:
        surface_temperature_name: surface_temperature
        ocean_fraction_name: ocean_fraction
      corrector:
        conserve_dry_air: false
        force_positive_names:
        - surface_snow_amount
        - surface_snow_area_fraction
        - total_moisture_content_of_soil_layer_0
        - total_moisture_content_of_soil_layer_1
        - total_moisture_content_of_soil_layer_2
        soil_moisture_corrector:
          soil_moisture_pattern: total_moisture_content_of_soil_layer
          soil_temperature_pattern: temperature_of_soil_layer
          temperature_threshold: 272.0
      next_step_forcing_names:
      - LHTFLsfc
      - SHTFLsfc
      - PRATEsfc
      - ULWRFsfc
      - DLWRFsfc
      - DSWRFsfc
      - USWRFsfc
      - total_frozen_precipitation_rate
      in_names:
      - x
      - y
      - z
      - land_fraction
      - ocean_fraction
      - sea_ice_fraction
      - glac_fraction
      - soil_fraction
      - lake_fraction
      - LHTFLsfc
      - SHTFLsfc
      - PRATEsfc
      - total_frozen_precipitation_rate
      - ULWRFsfc
      - DLWRFsfc
      - DSWRFsfc
      - USWRFsfc
      - HGTsfc
      - surface_temperature
      - surface_snow_amount
      - surface_snow_area_fraction
      - temperature_of_soil_layer_0
      - temperature_of_soil_layer_1
      - temperature_of_soil_layer_2
      - total_moisture_content_of_soil_layer_0
      - total_moisture_content_of_soil_layer_1
      - total_moisture_content_of_soil_layer_2
      out_names:
      - surface_snow_amount
      - surface_snow_area_fraction
      - surface_temperature
      - temperature_of_soil_layer_0
      - temperature_of_soil_layer_1
      - temperature_of_soil_layer_2
      - total_moisture_content_of_soil_layer_0
      - total_moisture_content_of_soil_layer_1
      - total_moisture_content_of_soil_layer_2
